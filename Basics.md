



# Linux概述

## 背景

### 简介

根据GNU通用公共许可证开发的免费Unix类型的操作系统。

1. 开源
2. 受欢迎
3. 支持大多数可用平台

采用“病毒式传播的GPL协议




### GNU、Linux与其他类UNIX系统

注意：UNIX和Linux是两套不同的操作系统

#### GNU/Linux系统

1. Linux内核
2. GNU软件/库

#### Linux发行版

Red Hat, Debain, SuSe, Mandrake, Redflag

1. 硬件在变化，使得操作系统也在不断地更新升级。
2. 发行版：会修改内核，会配合与内核配套的软件
   1. Debian理念：一定要配自由软件，不会配商业软件
   2. Ubuntu理念：用户好用就行
   
   不同的发行版会在几乎相同的内核上配套自己的外围软件。

#### 其他类Unix系统

1. FreeBSD。至今仍被一些计算机使用。
2. MacOS不免费分发，所以MacOS基于BSD，BSD有自己的BSD协议，但是由于BSD并没有Linux那么成熟，MacOS的开发难度会大一些。

### GPL的特殊之处

1. 大多数软件(包括Linux内核)均为GPL版(GNU通用公共许可证)
2. 称为"copyleft"(而不是"copyright")
   1. 您可以复制软件
   2. 获得源代码
   3. 您可以更改源代码并重新编译
   4. 您可以分发更改后的源和二进制文件
   5. 您可能会为此付费
   6. 您只能更改许可证
3. 因此，所有客户都享有与您相同的权利
4. 因此，您真的无法通过出售单独的软件。
5. 其他开源许可证(例如BSD)也可用

### 安装

1. Distributions：
   1. Redhat -> Fedora
   2. Debian
   3. SuSe
   4. Mandrake
   5. Ubuntu
2. Live CD
3. Using virtual machine：VMware, Virtual Box, etc.

## Linux安装

### 安装位置

实体机、虚拟机、WSL、LiveCD……任君选择

### 过程概览

1. 从可启动媒体启动系统
2. 所有安装程序都需要执行基本相同的步骤：
   1. 选择语言，键盘类型，鼠标类型
   2. 磁盘分区（重点讲解）
   3. 设置引导加载程序（重点讲解）
   4. 配置网络
   5. 配置用户和认证
   6. 选择安装软件的组
   7. 配置图形界面（可选）
   8. 安装软件包
   9. 创建启动盘

### 磁盘分区

#### MBR

MBR：Master Boot Record，主分区引导记录。

MBR是整个硬盘最重要的区域，一旦MBR物理实体损坏时，则该硬盘就差不多报废了，一般来说，MBR有512个字节，且可以分为两个部分：
1. 第一部分有446个字节，用于存放**引导代码**，即是bootloader。
2. 第二部分有64个字节，用于存放**磁盘分区表**.其中，每个分区的信息需要用**16个字节**来记录。因此，**一个硬盘最多可以有4个分区**，这4个分区称之为**主分区和扩展分区**(extended)。

重点说明的是，**扩展分区不能直接使用，还需要将其划分为逻辑分区才行，一般而言只能引导到主分区。**

由于MBR仅能保存4个分区的数据信息，如果超过4个，系统允许在额外的硬盘空间**存放另一份磁盘分区信息**，这就是扩展分区.若将硬盘分成3P+E，则E实际上是告诉系统，磁盘分区表在另外的那份分区表，即**扩展分区其实是指向正确的额外分区表**.本身扩展分区不能直接使用，还需要额外将扩展分区分成逻辑分区才能使用，因此，用户通过扩展分区就可以使用5个以上的分区了。

注意：所谓扩展分区仅仅是一个**指向下一个分区的指针**，这种指针结构将形成一个单向链表。

引导扇区：大小：512字节(hd的第一个扇区)

![img](https://pic4.zhimg.com/80/v2-039771e933fc23590ca888821fd6903f_1440w.png)

1. 由BIOS寻址
2. 内容：
   1. 446字节的程序代码(用于引导操作系统)
   2. 最大64字节的分区表 4条目
   3. 2个字节的"幻数"(0x55AA)

#### GPT

GPT(GUID Partition Table)

1. 新的硬件必须有新的代码与其对应
2. 不要在老的机器上装新的分区组织方式，主板可能都不支持
3. GPT是MBR不满足时代发展需要了才会选择使用
4. 支持上百个主分区，不需要扩展分区

1. GPT分区：全称为Globally Unique Identifier Partition Table，也叫做**GUID分区表**，它是UEFI 规范的一部分。由于硬盘容量的急速增长，MBR的2.2T容量难以满足要求，而UEFI BIOS的推广也为GPT的实现打下了坚实的技术基础，GPT应运而生。
2. GPT的结构图：

![img](https://pic3.zhimg.com/80/v2-06027b517bf5e4ff73392b8ee09d9b76_1440w.png)

LBA：**逻辑区块地址**(**Logical Block Address**, **LBA**)是描述计算机存储设备上数据所在区块的通用机制，一般用在像**硬盘**这样的辅助记忆设备。LBA可以意指某个数据区块的地址或是某个地址所指向的数据区块。

### 文件系统

#### 定义

什么是文件系统
1. 操作系统中负责访问和管理文件的部分
2. 文件及其某些属性的集合。它为引用这些文件的文件序列号提供了名称空间。(susv3)

Linux中的文件系统
1. VFS（抽象层，不是真实具体的某一个文件系统组织形式）
2. EXT2，EXT3，EXT4，FAT32（实际可用）等

#### 挂载点

1. 至少要创建
   1. /，750MB(建议1.5G或更高)
   2. 交换，大小等于内存量
2. 推荐：/boot(16MB)
3. 可能需要/想要创建其他分区：/usr，/usr/local，/var，/tmp，/opt，/home
4. Linux下的默认分区程序是fdisk，发行版可以添加自己的分区程序。希望支持GPT的话请使用`gparted`

![](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/9.png)



1. `/boot`：内核、bootloader的配置，包括引导加载程序相关的文件。内核的initrd、vmlinux、grub文件位于/boot下。
2. `/etc`：系统的配置文件所在地，下载软件的配置文件在也在这里，包含所有程序所需的配置文件
3. `/bin`：程序文件夹，包含二进制可执行文件，例如`ls`，其实是在执行一个程序；也有一部分程序在`/usr/bin`
4. `/mnt`：**挂载目录**，临时挂载目录，系统管理员可以挂载文件系统。
5. `/sbin`：系统二进制文件，但是这个目录下的Linux命令通常**由系统管理员使用，对系统进行维护**，例如`ifconfig/fdisk`也有部分程序在`/sbin`，例如分区命令`fdisk`
6. `/usr`：资源文件夹(和编程相关的)；编译器、默认的头文件、系统中的库文件，包含二进制文件、库文件、文档和二级程序的源代码
   1. `/usr/bin`中包含用户程序的二进制文件。`/bin`
   2. `/usr/sbin`中包含系统管理员的二进制文件。`/sbin`
   3. `/usr/lib`中包含了`/usr/bin`和`/usr/sbin`用到的库。
   4. `/usr/local`中包含了从源安装的用户程序。
7. `/lib`：系统库。包含**支持位于/bin和/sbin下的二进制文件的库文件**；库文件名为 `ld*或lib*.so.*`
8. `/proc`：包括**系统进行相关信息**。这是一个虚拟的文件系统，包含有关正在运行的进程的信息；系统资源以文本信息形式存在。
9. `/var`：系统里的可变数据，**变量文件**，==并不一定==是存放在磁盘上的数据，一般是存放在内存中的数据。
   1. 系统日志文件`/var/log`
   2. 包和数据库文件`/var/lib`
   3. 电子邮件`/var/mail`
   4. 打印队列`/var/spool`
   5. 锁文件`/var/lock`
   6. 多次重新启动需要的临时文件`/var/tmp`
10. `/dev`：包含**设备文件**，这些包括终端设备、USB或连接到系统的任何设备。例如`/dev/tty1`
11. `/tmp`：包含系统和用户创建的**临时文件**，当系统重新启动时，这个目录下的文件都将被删除。
12. `/home`：用home目录来存储他们的个人档案。
13. `/opt`：可选的附加应用程序
14. `/media`：用于挂载**可移动设备**的临时目录。举例来说，挂载CD-ROM的/media/cdrom，挂载软盘驱动器的/media/floppy
15. `/srv`：srv代表服务。包含服务器特定服务相关的数据。
16. 修改环境变量PATH，临时修改可以直接`PATH=$PATH:/bin`，但是要永久生效得修改配置文件`/etc/profile`

### 启动流程

> 下方启动流程以BIOS启动为例。UEFI不是这样启动的

#### BIOS

1. 查内存和硬件(POST)
2. 从非易失性存储器中加载选项
   1. 内存时序
   2. 启动设备顺序
3. 检查启动设备：软盘，CD-ROM，硬盘等
4. 加载启动设备的MBR并执行

#### Bootloader

1. 包含一个"boot loader"和分区表

2. 由LILO/GRUB进行传统设置

   1. GRUB

      程序存储在MBR(第一阶段)和/boot/grub(1.5和第二阶段)中，无需像LILO一样激活配置

      配置文件/boot/grub/grub.conf，通过grub-install安装在MBR中，甚至可以支持引导Windows

   2. LILO

      据配置文件配置MBR的程序。必须使用lilo命令以root用户身份运行。`/etc/lilo.conf`

#### 启动内核

1. 将压缩的内核映像加载到内存中
   - 可以将启动参数传递给Linux内核，例如设备信息
   - 可以选择加载初始根磁盘
   - 也可以启动其他操作系统
2. 内核解压缩并启动。

#### 初始化过程

1. 配置文件`/etc/inittab`
2. 运行水平

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/6.png" style="zoom: 25%;" />





### 安装软件（略）

1. From a tarball
   1. tar zxvf application.tar.gz
   2. cd application
   3. ./configure
   4. make
   5. su -
   6. make install
2. apt-get command *：在线下载
   1. update：是同步/etc/apt/source.list和/etc/apt/sources.list.d中列出的源的索引，这样**才能获取到最新的软件包**
   2. upgrade：是**升级已安装的所有软件包**，升级之后的版本就是本地索引里。因此在执行upgrade之前一定要执行update，这样子才是最新的，但是执行此命令需要谨慎。
   3. software&update就是在调用apt-get
3. dpkg：手动一个一个安装
4. aptitude
5. yum + rpm
6. RPM: RPM Package Management
   1. rpm –q –a
   2. rpm –ivh package-name
   3. rpm –e package-name

## 使用系统

###  多用户和多任务

1. Linux是一个**多用户，多任务**的操作系统：多个用户可以同时运行多个彼此独立的任务。
2. 在使用系统之前，总是需要"登录"：用**用户名，密码**识别自己
3. 多种登录系统的方式
   1. 控制台：直接连接的键盘，鼠标，显示器
   2. 串口
   3. 网络连接

### 虚拟终端

1. 在大多数Linux发行版中，控制台模拟许多虚拟终端
2. 每个虚拟终端都可以看作是一个单独的直接连接的控制台：不同的用户可以使用不同的虚拟终端
3. 典型设置：
   1. VT 1-6：**文本模式登录**
   2. VT 7：图形模式登录提示(如果启用)
   3. 使用Alt-Fn(如果在XWindows中为Ctrl-Alt-Fn)在VT之间切换

### Linux命令

1. Linux系统上的所有操作都可以通过键入命令来完成：运行Linux系统不需要GUI(X-Window)
2. 为了在X-Window中键入命令，您需要启动终端仿真器
3. 命令提示
   1. 可以自己配置
   2. `$`：以普通用户身份登录
   3. `#`：以root身份登录
4. 命令提示符：`用户名@计算机名:当前目录$`

### 命令语法

1. Linux命令具有以下格式：$ 命令 选项 参数
2. 示例：
   1. `$ ls`
   2. `$ ls –l`
   3. `$ ls /dev`
   4. `$ ls –l /dev`

### 处理文件和目录

1. 什么是文件？
   1. 数据的集合
   2. 可以写入或读取或两者兼有的对象。文件具有某些属性，包括访问权限和类型
2. 文件结构
   1. 通常：字节流，记录序列，记录树
   2. 在Linux中：**字节流**
3. 文件在逻辑上是字节，文件必然是整数字节。

## 文件类型

1. **==普通文件==**：文本或代码数据； 没有特别的内部结构
2. ==字符特殊文件==
3. ==块特殊文件==
   1. **特殊文件：代表硬件或逻辑设备**
   2. 位于名为/dev的目录中
4. ==socket==：**套接字文件**，最常在`/var/run`这个目录中看到这种文件类型。
5. ==符号链接==
   1. 软链接：类似windows上的快捷方式
   2. 硬链接：**同一个文件有两个文件名**，创建出来的硬链接不占用磁盘空间和inode号。
6. **==目录文件==**：该目录中的文件列表
7. ==管道==

补充
1. 设备文件类型和装载到Linux的**设备驱动**是有关的：指向对应的设备
2. 在Linux中，以`.`开头的文件是隐藏文件。
3. 可以尝试打开`/dev/random`字符文件(危险，可能导致终端字符乱码)
4. 打开`/dev/urandom`之后格式恢复



## 文件权限

文件权限可帮助您保护文件免受他人侵害系统上的用户

三个访问级别：
1. 用户：创建文件的用户
2. 组：拥有文件的组中的所有用户
3. 其他：其他

每一个用户对于文件都有**4个八进制数**

![](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/10.png)

### 默认权限

![image-20220504112216308](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220504112216308.png)

新建文件和目录的默认权限为644和755。

### 更改权限

| <img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/11.png"  /> | ![](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/12.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
|                                                              |                                                              |


### 特殊权限

#### 表示法

特殊权限的字母表示法会和x执行权限占据同样的位置。如果那个位置没有x，那么就用大写；如果那个位置有x，那就小写。

特殊权限的八进制表示法中，特殊权限写在最前面。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220504112409273.png" alt="image-20220504112409273" style="zoom: 67%;" />

#### SUID

SUID（Set User ID）使用小写字母 s 表示，出现在属主可执行权限位，具有 SUID 权限的文件会在其执行时，使调用者的有效身份临时变为该文件的拥有者，用于临时提升权限，使调用者暂时获得该文件拥有者的权限。

#### SGID

SGID（Set Group ID）与 SUID类似，使用小写字母 s 表示，出现在用户组可执行权限位，具有 SETGID 权限的文件会在其执行时，使调用者的有效用户组临时变为该文件属主的用户组，用于临时提升权限，使调用者暂时获得该文件所属用户组的权限。

#### SBIT

当某一个目录拥有 SBIT 权限时，则任何一个能够在这个目录下建立文件的用户，该用户在这个目录下所建立的文件，只有该用户自己和 root 可以删除，其他用户均不可以。



## 进程

什么是进程？
1. 进程是一项任务。
2. 进程是一个正在执行的程序实例。由执行程序，它的当前值，状态信息以及通过操作系统管理此进程执行情况的资源组成。
3. 一个地址空间，在该地址空间中执行一个或多个线程，以及这些线程所需的系统资源(susv3)

正在运行的程序就是流程的一个示例

![](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/13.png)

shell是一个读取命令并启动适当过程的过程。

### 开始和停止进程

所有流程均由其他流程启动
1. 父母/子女关系
2. 一个例外：init（PID 1）由内核本身启动（PID=0：交换进程，除了它，别的进程都是fork来的，而且都有父进程）
3. 树的层次结构

可以终止进程的原因有两个：
1. 该进程完成后会自行终止。
2. 该进程被另一个进程的信号终止

### 进程管理基本命令

1. ps：报告进程状态
2. pstree：显示进程树
3. jobs，fg，bg，<ctrl-z>：作业控制
   1. bg：后台执行
   2. fg：前台执行
5. nohup：运行命令，忽略挂断信号
6. nice：以特定优先级安排任务
6. kill：杀进程
7. top：显示最热门的CPU进程

### 守护进程

"守护进程"一词指的是一个永无止境的进程，通常是控制诸如打印机队列之类的系统资源或执行网络服务的系统进程。

<img src="https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/14.png" style="zoom: 25%;" />

## 获得帮助

1. "man"命令
2. info
3. command--help
4. HOWTO文档
5. 参考互联网

### man 命令

1. 使用man命令，您可以阅读命令的手册页
2. 手册页存储在/usr/man中
3. 手册页包括：
   1. 名称：命令名称和在线说明
   2. 简介：命令的语法
   3. 说明：有关命令的工作方式及其作用的说明
   4. 文件：命令使用的文件
   5. 错误：已知的错误和错误
   6. 另请参阅：与此命令相关的其他命令
4. "-k"选项：man–k打印
5. 手册分为8个部分：
   1. 用户命令
   2. 系统调用
   3. 库调用
   4. 设备
   5. 文件格式和协议
   6. 游戏
   7. 公约，宏程序包等
   8. 系统管理
6. 要选择正确的部分，请添加部分编号：man1 passwd，man 5 passwd

### info 命令

1. 用于阅读文档的程序，有时可以代替手册页
2. 有关信息的信息存储在/ usr / info中
3. 一些信息命令：
   1. space：下一屏文字
   2. delete：上一屏文字
   3. n：下一个节点
   4. p：上一个节点
   5. u：上节点
   6. q：退出信息
   7. < tab >：跳至下一个菜单项



## 重定向

### 标准输入、标准输出、标准错误

1. 对应的文件描述符：0, 1, 2：0号文件描述符是用来读的，1、2号是用来写的

![image-20220503232205132](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220503232205132.png)

![image-20220503232244375](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220503232244375.png)

1. C语言变量：stdin, stdout, stderr

### `<`, `>`, `>>`, `2>`

1. `>>`：文件追加
2. `>`：文件覆盖
3. `2>`：错误重定向
4. 例：kill –HUP 1234 > killout.txt 2> killerr.txt
5. 例：kill –HUP 1234 > killout.txt 2>& 1

```shell
cat < abc.txt

cat 文件名
# 这里的文件名作为cat参数存在
# 类似于C语言中，main(int argc, char** argv)
# 当argc等于0，在system.in中读，再system.out打印
# 当cat后面加上参数，就读出文件内容，输出在屏幕上
# cat < 文件名，这里是重定向
# 执行流程完全不一样，仍然是走else分支
```



## 管道

定义：一个进程的输出作为另一个进程的输入

例:
1. ls | wc –l：存在一个管道文件，这个文件作为输入传递给后面的命令
2. ls –lF | grep ^d
3. ar t /usr/lib/libc.a | grep printf | pr -4 -t

## 环境变量

1. 操作环境的参数
2. 查看和设置环境变量：echo, env（显示系统环境变量）, set（显示当前Shell的变量）

新建环境变量：临时：`export` 持久化：改`~/.bashrc`（当前用户）或`/etc/profile`（全体）

例: PATH环境变量
1. `echo $PATH`
2. `/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin:/home/song/bin`
3. `PATH=$PATH:.`
4. `export PATH`

## 高级命令与正则表达式

> 大概只需要能懂就行

1. find
2. sed
3. grep