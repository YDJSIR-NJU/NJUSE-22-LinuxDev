# 华为特辑

## openEuler基础

EulerOS是一款基于Linux内核的服务器操作系统，支持x86和ARM等多种处理器架构，适用于数据库、大数据、云计算、人工智能等应用场景；

==2019年底==EulerOS被正式推送开源社区，命名为openEuler。

- openEuler是一个开源、免费的Linux发行平台；
- 支持x86、ARM、RISC-V等多种处理器架构；
- 所有开发者、企业、商业组织都可以使用openEuler社区版本，也可以基于社区版本发布自己二次开发的操作系统版本。

![image-20220502224303291](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220502224303291.png)

## 平台框架

### 概览

![image-20220502224401173](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220502224401173.png)

### 毕昇JDK

毕昇JDK：一款针对ARM优化的高性能OpenJDK发行版

- ==ARM64优化==：`dmb`指令消除等提升性能（看弱内存序那里的解释）
- ==快速序列化技术==：提升序列化，反序列化性能
- ==GC优化==：让系统减少卡顿

==`SpecJBB` 提升20%==

### 线程间通信ITC

(1)通信线程位于同一个进程中，共享相同的地址空间，可以直接通过访问共享的地址空间实现信息交换

(2)通信线程位于相同的进程中，拥有相同的地址空间→IPC进程通信

对于情况(1)，为保证计算结果一致性，

•互斥机制主要使用自旋锁来实现。openEuler提供了==NUMA感知队列自旋锁==实现互斥机制，减小了NUMA体系结构中使用自旋锁的开销。

•同步机制主要使用信号量来实现。openEuler中提供==down原语==与==up原语==，能够实现线程的同步运行。

## 进程间通信IPC

IPC机制主要包括：1、信号（Signal）2、管道（Pipe）3、信号量 4、共享内存（Shared Memory）、5消息队列（Message Queue）、6、套接字（Socket）

与线程间通信机制不同，进程间通信机制需要打破进程间地址空间的隔离。

openEuler==增强了==两种进程间通信机制：

(1) ==共享内存==是一种在进程间高效地传递大量信息的通信方式，存在安全隐患。

(2) ==消息传递== 允许进程**通过交换消息的方式**来实现通信。消息传递关注信息的发送者不接收者，通过使用内核拷贝传递的信息，完成进程间的信息传递。

考虑到多个进程之间通信的需要，操作系统通常**预留出一块内存区作为共享内存**使用。

### 内存页相关说明

在openEuler中，各级页表的表项大小为==8B==。

页表的查询通常由专用的硬件内存管理单元（Memory Management Unit，MMU）**快速完成**，然后交给OS完成(建表、设置基址寄存器、访存管理)

openEuler将标准大页封装为一个==伪文件系统（`hugetlbfs`）提供给用户程序申请并访问==。

openEuler采用==Least Recently Used（LRU）最近最久未使用==策略实现页选择换出。

## 鲲鹏处理器体系架构

鲲鹏处理器是==基于ARMv8-64位RISC指令集==开发的==通用处理器==；

物理架构上包含SoC-实体-Chip←(2+1)←DIE ←(8)←cluster←(4)←core等概念。

使用大量寄存器：==通用X0-X30（31个，64位）==+==特殊寄存器==+==系统寄存器==

## ARM的弱内存序

### 乱序指令

现代CPU利用流水线技术可以在一个时钟周期内执行多条指令，幵且**不一定按照软件中规定的顺序执行**，这种情况称为乱序执行（`out-of-orderexecution`）

### 鲲鹏处理器所提供的屏障指令

DMB（Data Memory Barrier）：**保证该指令之前的内存访问结束**，指令之后的内存访问必须在此之后执行，其他非内存访问指令依然可以乱序执行。

DSB（Data Synchronization Barrier）：比DMB严格，**保证DSB之前的所有指令执行完成**，但是性能牺牲会比DMB更大。

ISB（Instruction Synchronization Barrier）：**保证之前的命令执行完成**，ISB之后的命令需要重新从cache或memory取指。用于异常处理。

### 内存顺序模型

绝对顺序模型：**禁止所有优化导致的乱序执行**，所有内存操作串行排队。

强内存顺序模型：以x86为代表，只允许**store-load（即先执行store指令，再执行load指令）**乱序执行。

弱内存顺序模型：以ARM为代表，允许所有情况下的指令乱序执行。

## openEuler相对通用Linux操作系统的增强

为了==充分发挥鲲鹏处理器的优势==，openEuler在==多核调用技术==、==软硬件协同==、==轻量级虚拟化==、==指令级优化==和==智能优化引擎==等斱面做了增强。

![image-20220502230913973](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220502230913973.png)

### 多核调用技术

CFS (Completely Fair Scheduler)

### 软硬件协同

#### 概述

在NUMA体系结构中，**访问本地节点比访问进程节点快得多**。同时，由于缓存失效，将导致额外的性能开销。因此，如果尽可能**连续地在同一个NUMA节点上进行传递锁**，**将有效地降低使用锁带来的开销**。

加速库结合计算机体系结构，**通过改变软件代码的数据结构和算法**，从而提升基础软件库的计算效率；或者利用计算机芯片多样性，通过软件开发，**充分发挥专有芯片高性能的特点**，提升特定领域基础功能的计算效率。

从上述加速库的定义上看出，加速库可以分为**软件加速库**和**硬件加速库**两大类，硬件加速库也叫做加速器，所以术语加速库有时特指软件加速库。

![image-20220502231853887](https://ydjsir-edu.oss-cn-shanghai.aliyuncs.com/SE3/pictures/image-20220502231853887.png)

#### KAE

鲲鹏加速引擎（Kunpeng Accelerator Engine，KAE）插件。

==对称/非对称加密==

==数字签名==

==压缩解压缩等算法，用于加速SSL/TLS应用和数据压缩==

### 轻量级虚拟化

#### `iSulad`轻量级容器

`iSula`为全量的容器软件栈，包括引擎、网络、存储、工具集与容器OS。

那个d是daemon的意思。

### 指令级优化

好像没有

### 智能优化引擎

A-Tune目前主要提供**智能决策**和**自动调优**两个能力。

智能决策是通过采集系统数据，利用AI选取适合当前系统业务负载的优化配置；

自动调优是基于系统或应用的配置参数及性能评价挃标，利用AI迭代得到性能最优的参数配置；